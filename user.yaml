-  name: Install user component
   hosts: user
   become: yes
   tasks:
   - name: setup nodejs repo
     ansible.builtin.shell: 'curl -sL https://rpm.nodesource.com/setup_lts.x | bash'

   - name: Install nodejs
     ansible.builtin.yum:
      name: nodejs
      state: installed

   - name: check  roboshop user exists or not
     ansible.builtin.command: id roboshop
     register: out

   - when: out.rc != 0
     name: create user roboshop
     become: yes
     ansible.builtin.user: 
      name: roboshop

   - name: check directory is present or not
     ansible.builtin.stat:
      path: /app
     register: output
     ignore_errors: true

   - when: output.stat.exists == False
     name: create /app
     become: yes
     ansible.builtin.file: 
      path: /app
      state: directory

   - name: Download user artifact
     ansible.builtin.get_url: 
      url: https://roboshop-builds.s3.amazonaws.com/user.zip
      dest: /tmp

   - name: extract user artifact
     ansible.builtin.unarchive:
       path: /tmp/user.zip
       dest: /app
       remote_src: yes

   - name: Install dependencies.
     ansible.builtin.command: npm install

   - name: copy user service
     ansible.builtin.copy:
       src: user.service
       dest: /etc/systemd/system/user.service

   - name: Reload Daemon
     ansible.builtin.systemd:
       daemon_reload: true
  
   - name: copy mongo repo
     ansible.builtin.copy:
       src: mongodb.repo
       dest: /etc/systemd/system/mongo.repo
      
   - name: Install MongoDB
     ansible.builtin.yum:
       name: mongodb-org-shell
       state: installed

   - name: load user date
     ansible.builtin.command: mongo --host mongodb.joindevops.top </app/schema/user.js

   - name: start and enable user
     ansible.builtin.service:
      name: user
      state: restarted
      enabled: true
       

      
    